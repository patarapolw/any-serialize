<!DOCTYPE html>
<html>

<head>
  <title>any-serialize.js</title>

  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.css" rel="stylesheet" />
  <style>
    .token.operator {
      background: unset;
    }

    html,
    body {
      margin: 0;
      padding: 0;
    }
  </style>
</head>

<body>
  <a href="https://github.com/patarapolw/any-serialize" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80"
      viewBox="0 0 250 250" style="fill:#64CEAA; color:#fff; position: absolute; top: 0; border: 0; right: 0;"
      aria-hidden="true">
      <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
      <path
        d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
        fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
      <path
        d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
        fill="currentColor" class="octo-body"></path>
    </svg></a>
  <style>
    .github-corner:hover .octo-arm {
      animation: octocat-wave 560ms ease-in-out
    }

    @keyframes octocat-wave {

      0%,
      100% {
        transform: rotate(0)
      }

      20%,
      60% {
        transform: rotate(-25deg)
      }

      40%,
      80% {
        transform: rotate(10deg)
      }
    }

    @media (max-width:500px) {
      .github-corner:hover .octo-arm {
        animation: none
      }

      .github-corner .octo-arm {
        animation: octocat-wave 560ms ease-in-out
      }
    }
  </style>
  <pre style="margin: 0;">
    <code lang="javascript" class="language-javascript" id="viewer"></code>
  </pre>

  <script id="mocha-browser">
    var describe = (name, fn) => fn()
    var it = (name, fn) => fn()
    var assert = (r) => {
      if (!r) {
        throw new Error('Assertion Error')
      }
    }
    assert.equal = (a, b) => assert(a === b)
    assert.notEqual = (a, b) => assert(a !== b)
  </script>

  <div id="script">
    <script type="module" async>
      
/* eslint-disable no-undef */
// Please open your JavaScript console (i.e. Inspect Element) to see the results.

/**
 * For how to use this inside web browsers, see https://unpkg.com/
 * import { Serialize, FullFunctionAdapter } from 'https://unpkg.com/any-serialize?module'
 *
 * Or,
 * Download and unzip https://github.com/patarapolw/any-serialize/archive/gh-pages.zip
 * And copy ./lib to your project
 *
 * For NPM users, it's `npm i any-serialize`
 */
import { Serialize, FullFunctionAdapter, UndefinedAdapter } from './lib/index.mjs'

class RegisteredClass {
  /**
   * You can turn off prefix with __prefix__ = ''
   */
  // static __prefix__ = ''
  static __key__ = 'unsafeName'

  static fromJSON (arg) {
    const { a, b } = arg
    return new RegisteredClass(a, b)
  }

  constructor (a, b) {
    this.a = a
    this.b = b
  }

  toJSON () {
    const { a, b } = this
    return { a, b }
  }
}

class UnregisteredClass {
  static funA () {
    return true
  }

  static a = 1

  b = 2

  funB () {
    return 'abc'
  }
}

const obj = {
  a: new Date(),
  r: /^hello /gi,
  f: (a, b) => a + b,
  s: new Set([1, 1, 'a']),
  registered: new RegisteredClass(2, 3),
  undefined: undefined,
  miscell: [
    undefined,
    NaN,
    Infinity,
    BigInt(900719925474099133333332),
    function fnLiteral (a) { return a }
  ]
}

describe('Deserializable', () => {
  const ser0 = new Serialize()

  /**
   * If talking about cloning, it can be done without an adapter.
   */
  const obj0 = ser0.clone(obj)

  // FullFunctionAdapter is required to deserialize Functions (because it can be unsafe).
  ser0.register(FullFunctionAdapter, RegisteredClass)

  const hash0 = ser0.hash(obj0)
  const stringifiedObj = ser0.stringify(obj0)
  const parsedObj = ser0.parse(stringifiedObj)
  const reStringifiedObj = ser0.stringify(parsedObj)
  const reParsedObj = ser0.parse(reStringifiedObj)
  const hash1 = ser0.hash(reParsedObj)

  it('results', () => {
    console.log('Serialize =', ser0)
    console.log(obj0, parsedObj, reParsedObj)
    console.log('stringifiedObj', stringifiedObj)
    console.log('reStringifiedObj', reStringifiedObj)
    console.log(hash0, hash1)
  })

  it('stringifyObj', () => {
    assert.equal(stringifiedObj, reStringifiedObj)
  })

  it('parsedFunction works', () => {
    assert.equal(reParsedObj.f(1, 2), 3)
  })

  it('hash is constant', () => {
    assert.equal(hash0, hash1)
  })
})

describe('Native Serialize', () => {
  const ser1 = new Serialize()
  const obj1 = ser1.clone(obj)
  ;(obj1).unregistered = new UnregisteredClass()

  /**
   * Symbol is quite special and must always be unique
   */
  it('Symbol is unique', () => {
    assert.notEqual(ser1.stringify(Symbol('hello')), ser1.stringify(Symbol('hello')))
  })

  /**
   * Deep equal is a little special in that
   * it requires hashing for objects that isn't Arrays nor plain Objects
   */
  it('use Serialize#deepEqual function', () => {
    assert(ser1.deepEqual(obj1, ser1.clone(obj1)))
  })

  /**
   * Some reality checks
   */
  it('Symbol(1) not deepEqual Symbol(1)', () => {
    assert(!ser1.deepEqual(Symbol(1), Symbol(1)))
  })

  it('NaN deepEqual NaN', () => {
    assert(ser1.deepEqual(NaN, NaN))
  })

  /**
   * To make NaN !== NaN, provide your own custom hash defintion for NaN
   */
  it('NaN can be made not deepEqual NaN', () => {
    const ser2 = new Serialize()
    ser2.register(
      {
        key: 'NaN',
        toJSON: () => Math.random()
      }
    )
    assert(!ser2.deepEqual(NaN, NaN))
  })

  it('undefined is a throwaway', () => {
    const obj2 = ser1.clone(obj1)
    ;(obj2.undefined) = undefined
    assert(ser1.deepEqual(obj1, obj2))
  })

  it('Can force compare undefined', () => {
    const ser2 = new Serialize()
    ser2.register(UndefinedAdapter)
    const obj2 = ser2.clone(obj1)
    ;(obj2.newKey) = undefined
    assert(!ser2.deepEqual(obj1, obj2))
  })
})

    </script>
  </div>

  <script>
    document.getElementById('viewer').innerHTML = document.getElementById('script').innerHTML.replace(/(^|\n) *</g, '$1&lt;')
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/components/prism-core.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>

</html>